---
title: "week8_all_2024_sites_data_exploration"
output: 
  html_document:
          toc: true
          toc_depth: 4
date: "2025-07-15"
---

# Data Import

## Importing 2024 & 2025 Data

See the full code for the break down for the importing and cleaning open the documents of the same name. Or here: 
- [2024 cleaning code](https://rpubs.com/hankhelmers/cleaning_2024_health_form_data) and 
- [2025 cleaning code](https://rpubs.com/hankhelmers/cleaning_2025_health_form_data)

### Create the R files if needed.

Purl (or stitch) together R code from the markdown cleaning files. These stitched files are stored in 'purl' folder with the date of the code purled.

```{r purl_cleaning, EVAL=FALSE, IGNORE=TRUE}
# library(knitr)
# 
# purl("cleaning_2024_health_form_data.Rmd", 
#      output = 
#        paste("purl/cleaning_2024_health_form_data",
#        Sys.Date(),".R"))
# 
# purl("cleaning_2025_health_form_data.Rmd", 
#      output = 
#        paste("purl/cleaning_2025_health_form_data",
#        Sys.Date(),".R"))
```

### Run the R files to get cleaned data

Next, we can run those extracted R files to actually import and clean the data.

```{r message=FALSE, warning=FALSE}
## 2024 data
source(paste("purl/cleaning_2024_health_form_data", Sys.Date(), ".R"))

## 2025 data
source(paste("purl/cleaning_2025_health_form_data", Sys.Date(), ".R"))
```

### Combining 2024 and 2025 data along canker area & DBH
```{r combined_years, message=FALSE, warning=FALSE}
library(dplyr)

# Add a 'year' column to each dataset to allow grouping/plotting by year
health_assess_2024 <- health_assess_2024 %>%
  mutate(year = 2024)

health_assess_2025 <- health_assess_2025 %>%
  mutate(year = 2025)

# Keep only the necessary columns for this hypothesis
sliced_2024 <- health_assess_2024 %>%
  select(year, seedling_y_n, dbh_cm, plant_height_ft, percent_live_canopy, has_canker, has_callous, base_canker_area, trunk_canker_area) 

sliced_2025 <- health_assess_2025 %>%
  select(year, seedling_y_n, dbh_cm, plant_height_ft, percent_live_canopy, has_canker, has_callous, base_canker_area, trunk_canker_area) 

# Combine the two data frames
combined_2024_2025 <- bind_rows(sliced_2024, sliced_2025) 
```




# Data exploration
## Summary of data
```{r paged.print=TRUE}
summary(combined_2024_2025$plant_height_ft)

summary(combined_2024_2025$dbh_cm)

summary(combined_2024_2025$percent_live_canopy)

summary(combined_2024_2025$has_canker)

summary(combined_2024_2025$has_callous)

summary(combined_2024_2025$trunk_canker_area)

summary(combined_2024_2025$base_canker_area)
```


## Proportion of seedlings
```{r}
bar_seedlings <- health_assess_2025 %>% ggplot(aes(x = health_assess_2025$seedling_y_n)) +
  geom_bar(aes(fill = seedling_y_n))

bar_seedlings
```

## Plant Height & DBH
```{r message=TRUE, warning=TRUE, paged.print=TRUE}
library(patchwork)

# Plant Height (ft)
mean_plant_height <- mean(plant_height_ft_2024, na.rm = TRUE)
median_plant_height <- median(plant_height_ft_2024, na.rm = TRUE)
print(mean_plant_height)
hist_plant_height <- health_assess_2024 %>% ggplot(aes(x = plant_height_ft_2024)) +
  geom_histogram(bins = 30, aes(fill = seedling_y_n_2024)) + 
  ylab("Number of Individuals") + 
  # Mean
  geom_vline(
    aes(xintercept = mean_plant_height),
    color = "#bdbdbd",
    linetype = "dashed",
    size = 1
  ) +
  annotate("text",
           color = "#bdbdbd",
           x = 17,
           y = 15,
           label = paste("Mean =", round(mean_plant_height, 2), "ft")) +
  
  # Median
  geom_vline(
    aes(xintercept = median_plant_height),
    color = "#636363",
    linetype = "solid",
    size = 1
  ) +
  annotate("text",
           color = "#636363",
           x = 11,
           y = 20,
           label = paste("Median =", round(median_plant_height, 2), "ft")) 
hist_plant_height

# DBH (cm)
mean_dbh <- mean(dbh_cm_2024, na.rm = TRUE)
median_dbh <- median(dbh_cm_2024, na.rm = TRUE)

hist_dbh <- health_assess_2024 %>% ggplot(aes(x = dbh_cm_2024)) +
  geom_histogram(bins = 30, aes(fill = seedling_y_n_2024)) + 
  ylab("Number of Individuals") + 
  # Mean
  geom_vline(
    aes(xintercept = mean_dbh),
    color = "#bdbdbd",
    linetype = "dashed",
    size = 1
  ) +
  annotate("text",
           color = "#bdbdbd",
           x = 15,
           y = 5,
           label = paste("Mean =", round(mean_dbh, 2), "cm")) +
  
  # Median
  geom_vline(
    aes(xintercept = median_dbh),
    color = "#636363",
    linetype = "solid",
    size = 1
  ) +
  annotate("text",
           color = "#636363",
           x = 11,
           y = 8,
           label = paste("Median =", round(median_dbh, 2), "cm")) 
hist_dbh

hist_plant_height / hist_dbh
```

## % Live Canopy
```{r}
mean_percent_live_canopy <- mean(percent_live_canopy_2024, na.rm = TRUE)
median_percent_live_canopy <- median(percent_live_canopy_2024, na.rm = TRUE)

hist_percent_live_canopy_2024 <- health_assess_2024 %>% 
  ggplot(aes(x = percent_live_canopy_2024)) +
  xlab("% Live Canopy in 2024") +
  ylab("Number of Individuals") + 
  geom_histogram(bins = 30, aes(fill = seedling_y_n_2024)) + 
  # Mean
  geom_vline(
    aes(xintercept = mean_percent_live_canopy),
    color = "#bdbdbd",
    linetype = "dashed",
    size = 1
  ) +
  annotate("text",
           color = "#bdbdbd",
           x = 70,
           y = 20, 
           label = paste("Mean =", round(mean_percent_live_canopy, 2), "%")) +
  
  # Median
  geom_vline(
    aes(xintercept = median_percent_live_canopy),
    color = "#636363",
    linetype = "solid",
    size = 1
  ) +
  annotate("text",
           color = "#636363",
           x = 85,
           y = 30,
           label = paste("Median =", round(median_percent_live_canopy, 2), "%")) 

hist_percent_live_canopy_2024
```

## Epicormics

```{r}
# ------------ BASE

mean_hist_epicormic_base <- mean(base_epicormics_2024, na.rm = TRUE)
median_hist_epicormic_base <- median(base_epicormics_2024, na.rm = TRUE)

hist_epicormic_base <- health_assess_2024 %>% ggplot(aes(x = base_epicormics_2024)) +
  geom_histogram(aes(fill = seedling_y_n_2024)) +
  xlab("Base Canker Area") + 
  ylab("Number of Individuals") + 
  title("2025 Base Canker Area") + 
  geom_histogram(bins = 30, aes(fill = seedling_y_n_2024)) + 
  # Mean
  geom_vline(
    aes(xintercept = mean_hist_epicormic_base),
    color = "#bdbdbd",
    linetype = "dashed",
    size = 1
  ) +
  annotate("text",
           color = "#bdbdbd",
           x = 1.3,
           y = 20, 
           label = paste("Mean =", round(mean_hist_epicormic_base, 2))) +
  
  # Median
  geom_vline(
    aes(xintercept = median_hist_epicormic_base),
    color = "#636363",
    linetype = "solid",
    size = 1
  ) +
  annotate("text",
           color = "#636363",
           x = 0.7,
           y = 30,
           label = paste("Median =", round(median_hist_epicormic_base, 2)))
```

```{r}
# ------------ TRUNK
mean <- mean(trunk_epicormics_2024, na.rm = TRUE)
median <- median(trunk_epicormics_2024, na.rm = TRUE)

hist_epicormic_trunk <- health_assess_2024 %>% ggplot(aes(x = trunk_epicormics_2024)) +
  geom_histogram(aes(fill = seedling_y_n_2024)) + 
  xlab("Trunk Canker Area") + 
  ylab("Number of Individuals") + 
  title("2025 Base Canker Area") + 
  # Mean
  geom_vline(
    aes(xintercept = mean),
    color = "#bdbdbd",
    linetype = "dashed",
    size = 1
  ) +
  annotate("text",
           color = "#bdbdbd",
           x = 0.6,
           y = 20, 
           label = paste("Mean =", round(mean, 2))) +
  
  # Median
  geom_vline(
    aes(xintercept = median),
    color = "#636363",
    linetype = "solid",
    size = 1
  ) +
  annotate("text",
           color = "#636363",
           x = 0.4,
           y = 30,
           label = paste("Median =", round(median, 2)))

hist_epicormic_base / hist_epicormic_trunk
```

## Has Canker & Callous 

```{r}
library(viridis)

bar_has_canker_2025 <- health_assess_2025 %>% ggplot(aes(x = has_canker)) +
  geom_bar() # aes(fill = has_callous_2024))

bar_has_callous_2025 <- health_assess_2025 %>% ggplot(aes(x = has_callous)) +
  geom_bar() # aes(fill = purdue_severity_2024))

bar_has_canker_2025 + bar_has_callous_2025
```

## Canker Areas
```{r}
mean_base_area <- mean(health_assess_2025$base_canker_area, na.rm = TRUE)
median_base_area <- median(health_assess_2025$base_canker_area, na.rm = TRUE)

hist_base_canker <- health_assess_2025 %>% ggplot(aes(x = base_canker_area)) +
  geom_histogram() + # aes(fill = has_callous_2024))
  xlab("Base Canker Area") + 
  ylab("Number of Individuals") + 
  title("2025 Base Canker Area") + 
  # Mean
  geom_vline(
    aes(xintercept = mean_base_area),
    color = "#bdbdbd",
    linetype = "dashed",
    size = 1
  ) +
  annotate("text",
           color = "#bdbdbd",
           x = 26,
           y = 10, 
           label = paste("Mean =", round(mean_base_area, 2), "%")) +
  
  # Median
  geom_vline(
    aes(xintercept = median_base_area),
    color = "#636363",
    linetype = "solid",
    size = 1
  ) +
  annotate("text",
           color = "#636363",
           x = 10,
           y = 25,
           label = paste("Median =", round(median_base_area, 2), "%"))

```

```{r}
mean_trunk_area <- mean(health_assess_2025$trunk_canker_area, na.rm = TRUE)
median_trunk_area <- median(health_assess_2025$trunk_canker_area, na.rm = TRUE)

hist_trunk_canker <- health_assess_2025 %>% ggplot(aes(x = trunk_canker_area)) +
  geom_histogram() + # aes(fill = has_callous_2024))
  ylab("Number of Individuals") + 
  # Mean
  geom_vline(
    aes(xintercept = mean_trunk_area),
    color = "#bdbdbd",
    linetype = "dashed",
    size = 1
  ) +
  annotate("text",
           color = "#bdbdbd",
           x = 32,
           y = 10, 
           label = paste("Mean =", round(mean_trunk_area, 2), "%")) +
  
  # Median
  geom_vline(
    aes(xintercept = median_trunk_area),
    color = "#636363",
    linetype = "solid",
    size = 1
  ) +
  annotate("text",
           color = "#636363",
           x = 30,
           y = 13,
           label = paste("Median =", round(median_trunk_area, 2), "%"))

hist_base_canker / hist_trunk_canker
```

```{r}
density_trunk_canker <- health_assess_2024 %>% ggplot(aes(x = trunk_canker_area_2024)) +
  geom_density()
  # + aes(fill = has_callous_2024))
  # # Mean
  # geom_vline(
  #   aes(xintercept = mean_trunk_area),
  #   color = "#bdbdbd",
  #   linetype = "dashed",
  #   size = 1
  # ) +
  # annotate("text",
  #          color = "#bdbdbd",
  #          x = 0.1,
  #          y = 0.1, 
  #          label = paste("Mean =", round(mean_trunk_area, 2), "%")) +
  # 
  # # Median
  # geom_vline(
  #   aes(xintercept = median_trunk_area),
  #   color = "#636363",
  #   linetype = "solid",
  #   size = 1
  # ) +
  # annotate("text",
  #          color = "#636363",
  #          x = 0.5,
  #          y = 0.5,
  #          label = paste("Median =", round(median_trunk_area, 2), "%"))


density_trunk_canker

```

```{r}

# Linear regression model
model <- lm(base_canker_area_2024 ~ dbh_cm_2024, data = health_assess_2024)
coefs <- coef(model)
r_squared <- summary(model)$r.squared
equation <- paste("y = ", round(coefs[2], 2), "x", " + ", round(coefs[1], 2),  sep = "")
   
point_base_canker <- health_assess_2024 %>% ggplot(aes(x = dbh_cm_2024, y =
                                                         base_canker_area_2024)) +
  geom_point(aes(color = purdue_severity_2024)) +
  geom_smooth(method = lm) +
  annotate(
    "text",
    x = 30,
    y = 80,
    label = equation,
    hjust = 0
  ) + 
  annotate(
    "text",
    x = 30,
    y = 65,
    label = paste("R-squared = ", round(r_squared, 4)),
    hjust = 0
  )
```

```{r}
# Linear regression model
model <- lm(trunk_canker_area_2024 ~ dbh_cm_2024, data = health_assess_2024)
coefs <- coef(model)
r_squared <- summary(model)$r.squared
equation <- paste("y = ", round(coefs[2], 2), "x", " + ", round(coefs[1], 2),  sep = "")

point_trunk_canker <- health_assess_2024 %>% ggplot(aes(x = dbh_cm_2024, y=trunk_canker_area_2024)) +
  geom_point(aes(color=purdue_severity_2024)) + 
  geom_smooth(method=lm) + 
    annotate(
    "text",
    x = 30,
    y = 80,
    label = equation,
    hjust = 0
  ) + 
  annotate(
    "text",
    x = 30,
    y = 65,
    label = paste("R-squared = ", round(r_squared, 4)),
    hjust = 0
  )

(point_base_canker / point_trunk_canker) + plot_layout(guides="collect")
```

```{r}
health_assess_2024 %>%
  ggplot() +
  geom_point(aes(x=dbh_cm_2024, y=base_canker_area_2024, colour = purdue_severity_2024)) + 
  theme_classic() + 
  facet_wrap(~purdue_severity)
```


## Canker severity
```{r}
bar_canker_severity <- health_assess_2024 %>% ggplot(aes(x = purdue_severity_2024)) + 
  geom_bar(aes(fill = purdue_severity_2024))

bar_canker_severity
```

# Summary Plots
```{r echo=FALSE, message=FALSE, warning=FALSE}
(bar_seedlings)

(hist_plant_height / hist_dbh)

bar_canker_severity

hist_percent_live_canopy_2024
  
(hist_epicormic_base / hist_epicormic_trunk) + plot_layout(guides="collect")

((bar_has_canker_2024 / bar_has_callous_2024))

((hist_trunk_canker / hist_base_canker))+plot_layout(guides="collect")

```

